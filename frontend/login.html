<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Login Page</title>
    <link rel="stylesheet" href="login.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">
    <style>
        .hidden {
            display: none;
        }
    </style>
</head>

<body class="hidden">
    <div class="container">
        <div class="login-box">
            <form id="login-form" method="POST" onsubmit="validateLogin(event)">
                <h2>Log in</h2>
                <div class="input-group">
                    <label for="username">
                        <i class="fas fa-user"></i>
                    </label>
                    <input type="text" id="username" name="username" placeholder="Username">
                </div>
                <div class="input-group">
                    <label for="password">
                        <i class="fas fa-lock"></i>
                    </label>
                    <input type="password" id="password" name="password" placeholder="Password">
                </div>
                <div class="show-password">
                    <input type="checkbox" id="show-password">
                    <label for="show-password">Show Password</label>
                </div>
                <button type="submit">Log in</button>
                <button type="button" onclick="showRegisterForm()">Register</button>
            </form>

            <form id="register-form" style="display: none;" method="POST" onsubmit="validateRegistrationForm(event)">
                <h2>Register</h2>
                <label for="admin_username">User Name: </label>
                <input type="text" id="admin_username" name="admin_username" required><br>
                <label for="admin_password">Password: </label>
                <input type="password" id="admin_password" name="admin_password" required><br>
                <label for="confirm_password">Confirm Password: </label>
                <input type="password" id="confirm_password" name="confirm_password" required><br>
                <button type="submit">Register</button>
                <button type="button" onclick="hideRegisterForm()">Cancel</button>
            </form>

            <div id="message"></div>
        </div>
        <div class="logo">
            <img src="/images/kape_cinco.jpg" alt="Kape Cinco">
        </div>
    </div>

    <script>
        document.addEventListener("DOMContentLoaded", () => {
            fetch('/backend/check_login.php')
                .then(response => response.json())
                .then(data => {
                    if (data.loggedIn) {
                        window.location.href = '/frontend/admin.html';
                    } else {
                        document.body.classList.remove('hidden');
                    }
                })
                .catch(error => console.error('Error:', error));
        });

        function validateLogin(event) {
            event.preventDefault(); 

            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;

            const formData = new FormData();
            formData.append('username', username);
            formData.append('password', password);

            fetch('/backend/login.php', {
                method: 'POST',
                body: formData
            })
            .then(response => response.json())
            .then(data => {
                if (data.adminExists) {
                    window.location.href = '/frontend/admin.html'; // Redirect to admin page
                } else if (data.error) {
                    alert(data.error);
                }
            })
            .catch(error => console.error('Error:', error));

            return false;
        }

        function validateRegistrationForm(event) {
            event.preventDefault();

            const username = document.getElementById('admin_username').value;
            const password = document.getElementById('admin_password').value;
            const confirmPassword = document.getElementById('confirm_password').value;

            if (password !== confirmPassword) {
                alert('Passwords do not match.');
                return false;
            }

            const formData = new FormData();
            formData.append('admin_username', username);
            formData.append('admin_password', password);

            fetch('/backend/register.php', {
                method: 'POST',
                body: formData
            })
            .then(response => response.json())
            .then(data => {
                if (data.message) {
                    alert(data.message);
                    hideRegisterForm();
                    document.getElementById('login-form').reset();
                    document.getElementById('register-form').reset();
                } else if (data.error) {
                    alert(data.error);
                }
            })
            .catch(error => console.error('Error:', error));

            return false;
        }

        // Show and hide registration form
        function showRegisterForm() {
            document.getElementById('login-form').style.display = 'none';
            document.getElementById('register-form').style.display = 'block';
        }

        function hideRegisterForm() {
            document.getElementById('register-form').style.display = 'none';
            document.getElementById('login-form').style.display = 'block';
        }
    </script>

</body>
</html>
